<!DOCTYPE html>
<html lang="es">

<head>
    <title>Ejemplo de formulario</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="formulario.css" />
    <link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
</head>

<body>
    <h3>Formulario</h3>

    <form id="formulario" method="get">
        <div class="linea_formulario">
            <label for="nombre">Nombre completo</label>
            <input type="text" name="nombre" id="nombre" required />
        </div>

        <div class="linea_formulario">
            <label for="fecha_nacimiento">Fecha de nacimiento</label>
            <input type="date" name="fecha_nacimiento" id="fecha_nacimiento" required />
        </div>

        <div class="linea_formulario">
            <label for="dni">DNI</label>
            <input type="text" name="dni" id="dni" pattern="\\d{8}[A-Z]" required />
        </div>

        <div class="linea_formulario">
            <label for="email">Email</label>
            <input type="email" name="email" id="email" required />
        </div>

        <div class="linea_formulario">
            <label for="password">Contraseña</label>
            <input type="password" name="password" id="password" minlength="8" required />
        </div>

        <div class="linea_formulario">
            <label for="password2">Contraseña (repetición)</label>
            <input type="password" name="password2" id="password2" minlength="8" required />
        </div>

        <div class="linea_formulario">
            <label for="favorito">Producto favorito</label>
            <select name="favorito" id="favorito" required>
                <option value="">Elige uno...</option>
                <option value="consolas">Consolas</option>
                <option value="pc">PC</option>
                <option value="desarrollo">Desarrollo</option>
            </select>
        </div>

        <div class="linea_formulario">
            <input type="button" name="enviar" id="enviar" value="Enviar datos" />
        </div>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const enviarBtn = document.getElementById("enviar");

            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
                return null;
            }

            function setCookie(name, value, days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                document.cookie = `${name}=${value}; expires=${date.toUTCString()}; path=/`;
            }

            enviarBtn.addEventListener("click", () => {
                let errores = 0;

                const formulario = document.getElementById("formulario");
                const elementos = formulario.elements;

                for (let i = 0; i < elementos.length; i++) {
                    if (!elementos[i].checkValidity()) {
                        errores++;
                    }
                }

                const password = document.getElementById("password").value;
                const password2 = document.getElementById("password2").value;
                if (password !== password2) {
                    errores++;
                }

                if (errores > 0) {
                    let intentos = parseInt(getCookie("intentos")) || 0;
                    intentos++;
                    setCookie("intentos", intentos, 7);
                    alert(`Hay errores en el formulario. Intentos fallidos: ${intentos}`);
                } else {
                    alert("Formulario enviado correctamente.");
                }
            });
        });
    </script>
</body>

</html>